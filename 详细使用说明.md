# ChatGPT Deep Research 自动化工具 - 详细使用说明

## 📋 目录

1. [项目简介](#项目简介)
2. [系统要求](#系统要求)
3. [快速开始](#快速开始)
4. [详细安装步骤](#详细安装步骤)
5. [配置说明](#配置说明)
6. [使用方法](#使用方法)
7. [高级功能](#高级功能)
8. [常见问题](#常见问题)
9. [故障排除](#故障排除)
10. [技术架构](#技术架构)

---

## 项目简介

ChatGPT Deep Research Automator 是一个基于 Docker 的自动化工具，可以通过编程方式使用 OpenAI ChatGPT 的 Deep Research（深度研究）功能。该工具通过自动化浏览器操作，实现批量处理研究任务，大幅提升研究效率。

### 核心特性

- **🤖 完全自动化**：无需手动操作 ChatGPT Web UI
- **🐳 Docker 容器化**：一键部署，环境隔离，无需复杂配置
- **👁️ VNC 实时监控**：通过 VNC 查看器实时观察自动化过程
- **📚 批量处理**：支持同时处理多个研究任务
- **💾 多格式输出**：自动保存 HTML 和 Markdown 格式的研究结果
- **🌏 多语言支持**：支持中文、英文、日文、韩文界面

---

## 系统要求

### 必需软件

- **Docker**：版本 20.10 或更高
- **Docker Compose**：版本 1.29 或更高
- **VNC Viewer**（可选）：用于监控自动化过程
  - 推荐：RealVNC Viewer、TightVNC Viewer 或 TigerVNC

### 硬件要求

- **内存**：至少 4GB RAM（推荐 8GB）
- **存储空间**：至少 2GB 可用空间
- **网络**：稳定的互联网连接

### 支持的操作系统

- Windows 10/11
- macOS 10.15 或更高
- Linux（Ubuntu 20.04+、Debian 10+、CentOS 8+ 等）

---

## 快速开始

```bash
# 1. 克隆仓库
git clone <repository-url>
cd ChatGPT-Deep-Research-Automator

# 2. 构建 Docker 镜像
docker compose build

# 3. 启动容器
docker compose up -d

# 4. 进入容器
docker compose exec chrome sh

# 5. 配置认证信息（首次使用）
cd /app
echo 'MAIL="your-email@example.com"' > .env
echo 'PASSWORD="your-password"' >> .env
python make_session_file.py

# 6. 运行单个任务
python run_DeepResearch.py --prompt_path sample_prompt.txt
```

---

## 详细安装步骤

### 步骤 1：安装 Docker

#### Windows
1. 下载 [Docker Desktop for Windows](https://www.docker.com/products/docker-desktop)
2. 运行安装程序并按照提示完成安装
3. 重启计算机
4. 启动 Docker Desktop

#### macOS
1. 下载 [Docker Desktop for Mac](https://www.docker.com/products/docker-desktop)
2. 将 Docker.app 拖到应用程序文件夹
3. 启动 Docker Desktop

#### Linux (Ubuntu/Debian)
```bash
# 更新包索引
sudo apt-get update

# 安装依赖
sudo apt-get install ca-certificates curl gnupg lsb-release

# 添加 Docker 官方 GPG 密钥
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

# 设置仓库
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# 安装 Docker Engine
sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin

# 验证安装
sudo docker run hello-world
```

### 步骤 2：克隆项目

```bash
# 使用 HTTPS
git clone https://github.com/your-username/ChatGPT-Deep-Research-Automator.git

# 或使用 SSH
git clone git@github.com:your-username/ChatGPT-Deep-Research-Automator.git

# 进入项目目录
cd ChatGPT-Deep-Research-Automator
```

### 步骤 3：构建 Docker 镜像

```bash
# 构建镜像（首次运行需要几分钟）
docker compose build

# 查看构建的镜像
docker images | grep chatgpt
```

### 步骤 4：启动容器

```bash
# 启动容器（后台运行）
docker compose up -d

# 查看容器状态
docker compose ps

# 查看容器日志
docker compose logs -f
```

---

## 配置说明

### 1. 认证配置（.env 文件）

首次使用需要配置 ChatGPT 账号信息：

```bash
# 进入容器
docker compose exec chrome sh

# 创建 .env 文件
cd /app
cat > .env << EOF
MAIL="your-email@example.com"
PASSWORD="your-password"
EOF

# 生成会话文件
python make_session_file.py
```

**注意事项**：
- 使用真实的 ChatGPT 账号邮箱和密码
- `.env` 文件会被 `.gitignore` 忽略，不会提交到版本控制
- 会话文件 `.session.dat` 生成后可重复使用，无需每次登录

### 2. 配置文件（config.yaml）

配置文件位于 `app/config.yaml`，包含以下设置：

```yaml
browser:
  headless: false  # 是否使用无头模式（true=不显示浏览器界面）

urls:
  chatgpt: "https://chatgpt.com/"  # ChatGPT 网址

prompt:
  default_path: "sample_prompt.txt"  # 默认提示文件路径
  encoding: "utf-8"  # 文件编码
  revise: ""  # 修订提示（留空则使用默认）

selectors:
  # CSS 选择器（通常无需修改）
  text_input_placeholder: "p[data-placeholder=\"Ask anything\"]"
  followup_placeholder: "p[data-placeholder=\"Provide as many details as possible for best results.\"]"
  parent_container: "w-full"
  send_button: "[data-testid=\"send-button\"]"
  speech_button: "[data-testid=\"composer-speech-button\"]"
  copy_button: "button[data-testid=\"copy-turn-action-button\"]"
  main_article: "main article"

buttons:
  deep_research: "Deep Research"  # Deep Research 按钮文本

timings:
  initial_wait: 10  # 初始等待时间（秒）
  button_check_interval: 0.5  # 按钮检查间隔（秒）
  max_wait_time_revise: 120  # 修订最大等待时间（秒）
  max_wait_time: 1800  # 最大等待时间（30分钟）
  short_wait: 1  # 短暂等待时间（秒）

output:
  base_dir: "response"  # 输出基础目录
  html_file: "output.html"  # HTML 输出文件名
  markdown_file: "output.md"  # Markdown 输出文件名

clipboard:
  command: "xclip -selection clipboard -o > output.md"  # 剪贴板命令

lang: "ja"  # 界面语言：ja(日文) / en(英文) / zh(中文) / ko(韩文)
```

#### 常用配置修改

**修改输出目录**：
```yaml
output:
  base_dir: "/app/my_results"  # 自定义输出目录
```

**启用无头模式（提高性能）**：
```yaml
browser:
  headless: true  # 不显示浏览器界面
```

**调整等待时间（网络较慢时）**：
```yaml
timings:
  initial_wait: 15  # 增加到15秒
  max_wait_time: 3600  # 增加到60分钟
```

---

## 使用方法

### 方法 1：处理单个提示文件

#### 基本用法

```bash
# 进入容器
docker compose exec chrome sh

# 运行脚本
cd /app
python run_DeepResearch.py --prompt_path <提示文件路径>
```

#### 示例

```bash
# 使用默认配置
python run_DeepResearch.py --prompt_path sample_prompt.txt

# 指定输出目录
python run_DeepResearch.py --prompt_path my_prompt.txt --output_dir /app/results

# 使用自定义配置文件
python run_DeepResearch.py --config custom_config.yaml --prompt_path my_prompt.txt
```

#### 参数说明

- `--prompt_path`：提示文件的路径（必需）
- `--output_dir`：输出目录（可选，默认为 `/app/response`）
- `--config`：配置文件路径（可选，默认为 `config.yaml`）

### 方法 2：批量处理多个提示文件

#### 基本用法

```bash
python batch_process_prompts.py --prompt_dir <提示文件目录>
```

#### 示例

```bash
# 基本批量处理
python batch_process_prompts.py --prompt_dir /app/prompts

# 指定输出目录和并发数
python batch_process_prompts.py \
  --prompt_dir /app/prompts \
  --output_base_dir /app/batch_results \
  --max-workers 3

# 调整任务启动间隔
python batch_process_prompts.py \
  --prompt_dir /app/prompts \
  --interval 15 \
  --max-workers 2
```

#### 参数说明

- `--prompt_dir`：包含提示文件的目录（必需）
- `--output_base_dir`：输出基础目录（可选，默认为 `/app/response`）
- `--max-workers`：最大并发进程数（可选，默认为 5）
- `--interval`：新任务启动间隔秒数（可选，默认为 10）

#### 批量处理目录结构

```
prompts/
├── research_topic_1.txt
├── research_topic_2.txt
└── research_topic_3.txt

# 运行后生成：
response/
├── research_topic_1/
│   ├── output.html
│   ├── output.md
│   └── url.txt
├── research_topic_2/
│   ├── output.html
│   ├── output.md
│   └── url.txt
└── research_topic_3/
    ├── output.html
    ├── output.md
    └── url.txt
```

### 方法 3：使用 VNC 监控

1. **启动 VNC Viewer**
2. **连接到**：`localhost:5900`
3. **输入密码**：`1234`
4. **观察自动化过程**：可以实时看到浏览器操作

---

## 高级功能

### 1. 自定义提示文件格式

提示文件支持多行文本和特殊格式：

```text
请深入研究以下主题：

主题：人工智能在医疗领域的应用

研究要点：
1. 当前主要应用场景
2. 技术挑战和限制
3. 未来发展趋势
4. 伦理和隐私问题

请提供详细的分析和案例研究。
```

### 2. 修订提示（Revise Prompt）

在 `config.yaml` 中设置修订提示，可以在初次研究后自动进行二次优化：

```yaml
prompt:
  revise: "请补充更多实际案例，并提供数据支持。"
```

如果留空，系统会使用默认提示。

### 3. 输出文件说明

每次运行会生成三个文件：

1. **output.html**：完整的 HTML 格式结果，包含格式和样式
2. **output.md**：Markdown 格式结果，便于编辑和版本控制
3. **url.txt**：ChatGPT 对话的 URL，可以直接访问查看原始对话

### 4. 会话管理

```bash
# 查看当前会话
ls -la /app/.session.dat

# 删除会话（需要重新登录）
rm /app/.session.dat

# 重新生成会话
python make_session_file.py
```

### 5. 容器管理

```bash
# 停止容器
docker compose stop

# 启动容器
docker compose start

# 重启容器
docker compose restart

# 删除容器（保留数据）
docker compose down

# 删除容器和数据卷
docker compose down -v

# 查看容器资源使用
docker stats
```

---

## 常见问题

### Q1：首次运行时提示 "会话文件不存在"

**解决方法**：
```bash
docker compose exec chrome sh
cd /app
python make_session_file.py
```

### Q2：VNC 连接失败

**可能原因**：
- 容器未启动：运行 `docker compose ps` 检查
- 端口被占用：检查 5900 端口是否被其他程序使用
- 防火墙阻止：临时关闭防火墙测试

**解决方法**：
```bash
# 检查端口
netstat -an | grep 5900  # Linux/Mac
netstat -an | findstr 5900  # Windows

# 重启容器
docker compose restart
```

### Q3：Deep Research 超时

**原因**：研究任务复杂，需要更长时间

**解决方法**：修改 `config.yaml`
```yaml
timings:
  max_wait_time: 3600  # 增加到60分钟
```

### Q4：批量处理时部分任务失败

**解决方法**：
- 减少并发数：`--max-workers 2`
- 增加启动间隔：`--interval 20`
- 检查失败的提示文件格式

### Q5：输出文件为空或不完整

**可能原因**：
- 网络不稳定
- ChatGPT 服务异常
- 选择器失效（ChatGPT 界面更新）

**解决方法**：
1. 检查网络连接
2. 通过 VNC 查看实际运行情况
3. 重新运行任务
4. 更新项目到最新版本

### Q6：如何在 Windows 上使用？

项目完全支持 Windows，但需要注意：
- 使用 PowerShell 或 CMD 运行 Docker 命令
- 路径使用反斜杠或正斜杠均可
- 确保 Docker Desktop 正在运行

---

## 故障排除

### 日志查看

```bash
# 查看容器日志
docker compose logs -f

# 查看最近100行日志
docker compose logs --tail=100

# 查看特定时间的日志
docker compose logs --since 30m
```

### 调试模式

修改 `config.yaml` 启用详细日志：

```yaml
browser:
  headless: false  # 显示浏览器界面以便调试
```

### 重置环境

```bash
# 完全重置
docker compose down -v
docker compose build --no-cache
docker compose up -d
```

### 常见错误代码

| 错误信息 | 原因 | 解决方法 |
|---------|------|---------|
| `Connection refused` | Docker 未启动 | 启动 Docker Desktop |
| `Permission denied` | 权限不足 | 使用 `sudo` 或管理员权限 |
| `Port already in use` | 端口被占用 | 修改 `docker-compose.yml` 中的端口 |
| `Element not found` | 页面元素变化 | 更新项目或修改选择器 |
| `Timeout` | 等待时间不足 | 增加 `max_wait_time` |

---

## 技术架构

### 核心技术栈

- **Python 3.10**：主要编程语言
- **nodriver**：无检测浏览器自动化库
- **Docker**：容器化部署
- **Chromium**：浏览器引擎
- **Xvfb**：虚拟显示服务器
- **x11vnc**：VNC 服务器
- **Fluxbox**：轻量级窗口管理器

### 项目结构

```
ChatGPT-Deep-Research-Automator/
├── app/                          # 应用代码
│   ├── batch_process_prompts.py  # 批量处理脚本
│   ├── make_session_file.py      # 会话生成脚本
│   ├── run_DeepResearch.py       # 主运行脚本
│   ├── config.yaml               # 配置文件
│   └── response/                 # 默认输出目录
├── scripts/                      # 启动脚本
│   └── startup.sh                # 容器启动脚本
├── gifs/                         # 演示动图
├── docker-compose.yml            # Docker Compose 配置
├── Dockerfile                    # Docker 镜像定义
├── requirements.txt              # Python 依赖
├── local.conf                    # 字体配置
├── .gitignore                    # Git 忽略文件
└── README.md                     # 项目说明
```

### 工作流程

1. **启动容器**：Docker 启动包含 Chromium 和 VNC 的环境
2. **加载会话**：从 `.session.dat` 加载 ChatGPT 登录状态
3. **打开页面**：使用 nodriver 控制 Chromium 访问 ChatGPT
4. **输入提示**：自动输入研究提示并点击 Deep Research
5. **等待完成**：监控页面状态，等待研究完成
6. **提取结果**：获取 HTML 和 Markdown 格式的结果
7. **保存文件**：将结果保存到指定目录

### 依赖说明

```python
nodriver      # 浏览器自动化，绕过反爬虫检测
PyYAML        # YAML 配置文件解析
pyperclip     # 剪贴板操作（用于复制结果）
```

---

## 贡献指南

欢迎提交 Issue 和 Pull Request！

### 开发环境设置

```bash
# 克隆仓库
git clone <repository-url>
cd ChatGPT-Deep-Research-Automator

# 创建开发分支
git checkout -b feature/your-feature

# 进行修改后提交
git add .
git commit -m "Add: your feature description"
git push origin feature/your-feature
```

---

## 许可证

请查看 LICENSE 文件了解详情。

---

## 联系方式

- **问题反馈**：通过 GitHub Issues 提交
- **功能建议**：通过 GitHub Discussions 讨论

---

## 更新日志

### v1.0.0
- 初始版本发布
- 支持单个和批量处理
- VNC 监控功能
- 多格式输出

---

**祝你使用愉快！🚀**
